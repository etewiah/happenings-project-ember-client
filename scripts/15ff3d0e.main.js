!function(){window.HappeningsProjectEmberClient=Ember.Application.create()}(),function(){HappeningsProjectEmberClient.ApplicationRoute=Ember.Route.extend({})}(),function(){HappeningsProjectEmberClient.HappeningRoute=Ember.Route.extend({events:{filterHappeningsByCategory:function(a,b){var c=this.controllerFor("application");c.set("navStructure.category",b.value),c.set("navStructure.range","today"),this.transitionTo("happening.when",{})},filterHappeningsByRange:function(a,b){var c=this.controllerFor("application");c.set("navStructure.range",b.value),this.transitionTo("happening.when",{})},filterHappeningsByCity:function(a,b){var c=this.controllerFor("application");c.set("navStructure.city",b.value),this.transitionTo("happening.when",{})},showOtherDetails:function(a,b){var c=b.name;$(a).each(function(){this.set("currentItemName",c)});var d=this.controllerFor("happening");d.set("details",b),this.render("details",{into:"happeningOther",outlet:"details"})},showMovieScreenings:function(a,b){var c=b[0].movie_happening.movie_name;$(a).each(function(){this.set("currentItemName",c)});var d=this.controllerFor("happening");d.set("screenings",b),this.render("screenings",{into:"happeningCinema",outlet:"screenings"})}}})}(),function(){HappeningsProjectEmberClient.HappeningWhenRoute=Ember.Route.extend({model:function(a){return a},serialize:function(){return applicationController=this.controllerFor("application"),applicationController.get("navStructure")},renderTemplate:function(){"cinema"===HappeningsProjectEmberClient.Happening.currentCategory?(this.render("happeningCinema"),this.render("screenings",{into:"happeningCinema",outlet:"screenings"})):(this.render("happeningOther"),this.render("details",{into:"happeningOther",outlet:"details"}))},setupController:function(a,b){if(applicationController=this.controllerFor("application"),void 0!==b.category&&applicationController.set("navStructure.category",b.category),void 0!==b.city&&applicationController.set("navStructure.city",b.city),void 0!==b.range&&applicationController.set("navStructure.range",b.range),HappeningsProjectEmberClient.Happening.currentCategory=applicationController.get("navStructure.category"),HappeningsProjectEmberClient.Happening.currentCity=applicationController.get("navStructure.city"),HappeningsProjectEmberClient.Happening.currentRange=applicationController.get("navStructure.range"),"cinema"===HappeningsProjectEmberClient.Happening.currentCategory){var c=HappeningsProjectEmberClient.Happening.getCinemaHappenings();c.then(function(b){a.set("content",b),b[0].cssClass="active",a.set("screenings",b[0].screenings)})}else{var c=HappeningsProjectEmberClient.Happening.getHappenings();c.then(function(b){a.set("content",b),a.set("details",b[0])})}}})}(),function(){HappeningsProjectEmberClient.IndexRoute=Ember.Route.extend({redirect:function(){happeningController=this.controllerFor("happening"),this.transitionTo("happening.when",{})}})}(),function(){HappeningsProjectEmberClient.ApplicationController=Ember.ArrayController.extend({navStructure:{city:"Madrid",range:"this_week",category:"music"},rangeNavItems:function(){return HappeningsProjectEmberClient.NavItem.getRangeNavItems(this.get("navStructure.range"),this.get("navStructure.category"))}.property("navStructure.category","navStructure.range"),cityNavItems:function(){return HappeningsProjectEmberClient.NavItem.getCityNavItems(this.get("navStructure.city"))}.property("navStructure.city"),categoryNavItems:function(){return HappeningsProjectEmberClient.NavItem.getCategoryNavItems(this.get("navStructure.category"))}.property("navStructure.category")})}(),function(){HappeningsProjectEmberClient.HappeningController=Ember.ArrayController.extend({needs:["application"]})}(),function(){HappeningsProjectEmberClient.HappeningWhenController=Ember.ObjectController.extend({needs:["application"],headerTitle:function(){var a="Music events in ";return"meetups"===HappeningsProjectEmberClient.Happening.currentCategory?a="Meetups in ":"eventful"===HappeningsProjectEmberClient.Happening.currentCategory?a="Other events in ":"cinema"===HappeningsProjectEmberClient.Happening.currentCategory&&(a="Films showing in "),a+HappeningsProjectEmberClient.Happening.currentCity+" "+HappeningsProjectEmberClient.Happening.currentRange.replace("_"," ")}.property("content"),noResults:function(){var a=!0;return this.content&&this.content.length>0&&(a=!1),a}.property("content")})}(),function(){HappeningsProjectEmberClient.Happening=DS.Model.extend({cssClass:function(){return this.currentItemName&&this.currentItemName===this.name?"active":""}.property("currentItemName"),hasVenue:function(){return this.venue_name||this.venue_address?!0:!1}.property("venue_name","venue_address")}),HappeningsProjectEmberClient.Happening.reopenClass({currentCity:"",currentRange:"",currentCategory:"",getQueryData:function(){var a={city:HappeningsProjectEmberClient.Happening.currentCity},b=new Date;if(b.setUTCHours(0,0,0,0),"tomorrow"===HappeningsProjectEmberClient.Happening.currentRange.toLowerCase()){var c=new Date;c.setDate(b.getDate()+1),c.setUTCHours(0,0,0,0),a.day_range=c.toISOString()}else if("this_week"===HappeningsProjectEmberClient.Happening.currentRange.toLowerCase())a.week_range=b.toISOString();else if("next_week"===HappeningsProjectEmberClient.Happening.currentRange.toLowerCase()){var d=new Date;d.setDate(b.getDate()+7),d.setUTCHours(0,0,0,0),a.week_range=d.toISOString()}else a.day_range=b.toISOString(),HappeningsProjectEmberClient.Happening.currentRange="today";return a},getCinemaHappenings:function(){var a="http://happenings-project.dev/api/v1/movie_happenings",b=HappeningsProjectEmberClient.Happening.getQueryData();return $.getJSON(a,b).then(function(a){var b=[];if(a.length>0)var c=a[0].movie_name;return $(a).each(function(){this.screenings.movie_name=this.movie_name;var a=HappeningsProjectEmberClient.Happening.createRecord({currentItemName:c,name:this.movie_name,screenings:this.screenings});b.push(a)}),b})},getHappenings:function(){var a="http://happenings-project.dev/api/v1/flat_happenings",b=HappeningsProjectEmberClient.Happening.getQueryData();return b.class="meetups"===HappeningsProjectEmberClient.Happening.currentCategory?"meetup":"eventful"===HappeningsProjectEmberClient.Happening.currentCategory?"eventful":"scrob",$.getJSON(a,b).then(function(a){var b=[];if(a.flat_happenings.length>0)var c=a.flat_happenings[0].name;return $(a.flat_happenings).each(function(){var a=null;this.images&&this.images.venue&&(a=this.images.venue);var d=null;this.images&&this.images.main&&(d=this.images.main);var e=null;this.urls&&this.urls.happening_url&&(e=this.urls.happening_url);var f=null;this.urls&&this.urls.venue_url&&(f=this.urls.venue_url);var g=new Date(this.start_time).toString();this.recurring_details&&(g=this.recurring_details);var h=HappeningsProjectEmberClient.Happening.createRecord({currentItemName:c,name:this.name,description_html:this.description_html,start_date:g,main_image_url:d,venue_image_url:a,source_url:e,venue_url:f,venue_address:this.address,venue_name:this.venue_name,city:this.city});b.push(h)}),b})}})}(),function(){HappeningsProjectEmberClient.NavItem=DS.Model.extend({activeItemTitle:"",cssClass:function(){return this.value.toLowerCase()===this.get("activeItemTitle").toLowerCase()?"active":""}.property("activeItemTitle")}),HappeningsProjectEmberClient.NavItem.reopenClass({getNavItems:function(a){var b=[];return $(a).each(function(){var a=HappeningsProjectEmberClient.NavItem.createRecord(this);b.push(a)}),b},getCityNavItems:function(a){var b=[{title:"Madrid",value:"Madrid",activeItemTitle:a},{title:"Berlin",value:"Berlin",activeItemTitle:a}];return HappeningsProjectEmberClient.NavItem.getNavItems(b)},getCategoryNavItems:function(a){var b=[{title:"Music",value:"music",activeItemTitle:a},{title:"Meetups",value:"meetups",activeItemTitle:a},{title:"Cinema",value:"cinema",activeItemTitle:a},{title:"Other",value:"eventful",activeItemTitle:a}];return HappeningsProjectEmberClient.NavItem.getNavItems(b)},getRangeNavItems:function(a,b){var c=[{title:"today",value:"today",activeItemTitle:a},{title:"tomorrow",value:"tomorrow",activeItemTitle:a}];return"cinema"!==b&&(c.push({title:"this week",value:"this_week",activeItemTitle:a}),c.push({title:"next week",value:"next_week",activeItemTitle:a})),HappeningsProjectEmberClient.NavItem.getNavItems(c)}})}(),function(){HappeningsProjectEmberClient.HappeningCinemaView=Ember.View.extend({templateName:"happening/cinema"})}(),function(){HappeningsProjectEmberClient.HappeningOtherView=Ember.View.extend({templateName:"happening/other"})}(),function(){HappeningsProjectEmberClient.HappeningView=Ember.View.extend({templateName:"happening"})}(),function(){HappeningsProjectEmberClient.HappeningWhenView=Ember.View.extend({templateName:"happening/when"})}(),function(){HappeningsProjectEmberClient.Router.map(function(){this.resource("happening",{path:"/all"},function(){this.route("when",{path:"/"}),this.route("when",{path:"/:category"}),this.route("when",{path:"/:category/:city"}),this.route("when",{path:"/:category/:city/:range"})})})}(),function(){HappeningsProjectEmberClient.Store=DS.Store.extend({})}();